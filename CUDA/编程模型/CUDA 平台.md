# 1. 计算能力和流式多处理器版本

每款NVIDIA GPU都有一个计算能力（CC）编号，它表明该GPU支持哪些功能，并规定了该GPU的一些硬件参数。这些规格在5.1节附录中有详细说明。所有NVIDIA GPU及其计算能力的列表可在CUDA GPU计算能力页面上查询。

计算能力用主版本号和次版本号表示，格式为X.Y，其中X为主版本号，Y为次版本号。例如，CC 12.0的主版本号为12，次版本号为0。计算能力直接对应于SM的版本号。例如，CC 12.0的GPU中的SM具有sm_120版本。此版本用于标记二进制文件。

# 2. CUDA工具包和NVIDIA驱动程序

NVIDIA驱动程序可以被视为GPU的操作系统。NVIDIA驱动程序是一个软件组件，必须安装在主机系统的操作系统上，是所有GPU使用（包括显示和图形功能）所必需的。NVIDIA驱动程序是CUDA平台的基础。除了CUDA之外，
NVIDIA驱动程序还提供了其他所有使用GPU的方法，例如Vulkan和Direct3D。NVIDIA驱动程序的版本号如r580。

CUDA 工具包是一套用于编写、构建和分析利用 GPU 计算的软件的库、头文件和工具。CUDA 工具包是与 NVIDIA 驱动程序相分离的软件产品。

CUDA 运行时是 CUDA 工具包所提供的库中的一个特例。CUDA 运行时既提供了 API，也提供了一些语言扩展，用于处理常见任务，例如内存分配、在 GPU 与其他 GPU 或 CPU 之间复制数据以及启动内核等。CUDA 运行时的 API 组件被称为 CUDA 运行时 API。

## 2.1 CUDA运行时API和CUDA驱动API

CUDA运行时API构建在一个名为CUDA驱动API的低级API之上，后者是NVIDIA驱动程序公开的API。本指南重点介绍CUDA运行时API所公开的API。如果需要，仅使用驱动API也能实现所有相同的功能。有些功能仅可通过驱动API使用。
应用程序可以使用其中一种API，也可以同时使用两种并实现互操作。CUDA驱动API部分介绍了运行时API与驱动API之间的互操作。

CUDA 运行时 API 函数的完整 API 参考可在CUDA 运行时 API 文档中找到。

CUDA 驱动程序 API 的完整 API 参考可在 CUDA 驱动程序 API 文档 中找到。

# 3. 并行线程执行（PTX）

CUDA平台的一个基础但有时不为人注意的层是并行线程执行（PTX）虚拟指令集架构（ISA）。PTX是NVIDIA GPU的一种高级汇编语言。PTX在真实GPU硬件的物理ISA之上提供了一个抽象层。与其他平台类似，
应用程序可以直接用这种汇编语言编写，不过这样做会给软件开发带来不必要的复杂性和难度。

特定领域语言和高级语言编译器可以生成PTX代码作为中间表示（IR），然后使用NVIDIA的离线或即时（JIT）编译工具来生成可执行的二进制GPU代码。
这使得CUDA平台不仅可以通过NVIDIA提供的工具（如NVCC：NVIDIA CUDA编译器）所支持的语言进行编程，还能通过其他语言实现编程。

由于GPU的性能会随着时间推移不断变化和提升，PTX虚拟ISA规范采用了版本化管理。与SM版本类似，PTX版本也对应着一种计算能力。例如，支持计算能力8.0所有特性的PTX被称为compute_80。

# 4. Cubins 和 Fatbins

CUDA应用程序和库通常是用C++等更高级的语言编写的。这种高级语言会被编译为PTX，然后PTX再被编译为适用于物理GPU的真实二进制文件，称为CUDA二进制文件，简称cubin。cubin具有特定的二进制格式，适用于特定的SM版本，例如sm_120。

使用GPU计算的可执行文件和库二进制文件既包含CPU代码，也包含GPU代码。GPU代码存储在一个名为fatbin的容器中。Fatbin可以包含针对多个不同目标的cubin和PTX。例如，一个应用程序可以使用针对多种不同GPU架构（即不同的SM版本）的二进制文件进行构建。
当应用程序运行时，其GPU代码会加载到特定的GPU上，并从fatbin中选用适合该GPU的最佳二进制文件。

![](https://docs.nvidia.com/cuda/cuda-programming-guide/_images/fatbin.png)
图8 可执行文件或库的二进制文件既包含CPU二进制代码，也包含用于GPU代码的fatbin容器。一个fatbin可以同时包含cubin GPU二进制代码和PTX虚拟ISA代码。PTX代码可通过即时编译（JIT）用于未来的目标设备。

Fatbins 还可以包含一个或多个 PTX 版本的 GPU 代码，其用途在 PTX 兼容性 中有描述。图 8 展示了一个应用程序或库二进制文件的示例，该文件包含多个 cubin 版本的 GPU 代码以及一个版本的 PTX 代码。

## 4.1 二进制兼容性

NVIDIA GPU在特定情况下保证二进制兼容性。具体来说，在计算能力的主版本内，计算能力次版本大于或等于目标cubin版本的GPU可以加载并执行该cubin。例如，如果某个应用程序包含为计算能力8.6编译的代码的cubin，那么该cubin可以在计算能力为8.6或8.9的GPU上加载和执行。
但是，它无法在计算能力为8.0的GPU上加载，因为该GPU的计算能力次版本0低于代码的次版本6。

NVIDIA GPU在主要计算能力版本之间不具有二进制兼容性。也就是说，为计算能力8.6编译的cubin代码无法在计算能力9.0的GPU上加载。

在讨论二进制代码时，上述示例中的二进制代码通常会被提及具有sm_86这样的版本。这等同于说该二进制文件是为计算能力8.6构建的。这种简写形式经常被使用，因为开发者就是通过这种方式向NVIDIA CUDA编译器nvcc指定该二进制文件的构建目标的。

## 4.2 PTX 兼容性

GPU代码可以以二进制或PTX形式存储在可执行文件中，这在立方文件和胖二进制文件中有介绍。当应用程序存储GPU代码的PTX版本时，该PTX可以在应用程序运行时针对计算能力等于或高于PTX代码计算能力的任何设备进行即时编译（JIT）。例如，如果某个应用程序包含适用于compute_80的PTX，
那么该PTX代码可以在应用程序运行时即时编译为更高版本的SM，如sm_120。这实现了与未来GPU的向前兼容性，而无需重新构建应用程序或库。

## 4.3 即时编译

应用程序在运行时加载的PTX代码会由设备驱动程序编译为二进制代码。这称为即时（JIT）编译。即时编译会增加应用程序的加载时间，但能让应用程序受益于每个新设备驱动程序带来的任何新编译器改进。它还使应用程序能够在编译时不存在的设备上运行。
